# 仕様書

この仕様書は、TSVインポートを用いた進捗管理ツール（以下「本アプリ」）の要件定義・設計・テスト計画を実装者が迷わず進められるレベルで記述する。未確定事項は明示的に `TBD` とする。

## 画面別仕様書（分割）

各画面の詳細仕様は個別ファイルに分割しています。実装／デザインの詳細はそれぞれの専用ファイルを参照してください。

- チームベロシティ: [c:\製品\その他\新しいフォルダー\docs\specs\team-velocity-spec.md](c:\製品\その他\新しいフォルダー\docs\specs\team-velocity-spec.md)
- フィーチャー: [c:\製品\その他\新しいフォルダー\docs\specs\feature-spec.md](c:\製品\その他\新しいフォルダー\docs\specs\feature-spec.md)
- 進捗管理: [c:\製品\その他\新しいフォルダー\docs\specs\progress-spec.md](c:\製品\その他\新しいフォルダー\docs\specs\progress-spec.md)
- 設定: [c:\製品\その他\新しいフォルダー\docs\specs\settings-spec.md](c:\製品\その他\新しいフォルダー\docs\specs\settings-spec.md)
- 実装方針: [c:\製品\その他\新しいフォルダー\docs\specs\implementation-spec.md](c:\製品\その他\新しいフォルダー\docs\specs\implementation-spec.md)
- デザイン方針: [c:\製品\その他\新しいフォルダー\docs\specs\design-spec.md](c:\製品\その他\新しいフォルダー\docs\specs\design-spec.md)

---

## 0. サマリー

- 何を作るか：チーム／個人のベロシティ（Story Points）と総工数をTSVから取り込み、可視化・編集するWebアプリの仕様書。
- 成功条件：TSVインポートで正しくデータが反映され、各画面で集計やフィルタが期待どおり動作すること（詳細は各画面仕様参照）。

---

## 1. Project Decisions（前提決め）

- **アプリ種別**: シングルページアプリ（SPA）、画面はタブで切り替える（本仕様での前提）
- **環境**: Vite（開発/ビルド環境）
- **言語/フレームワーク**: React + TypeScript（前提）
- **ルーティング**: 行わない。タブ切替は内部 state による（URL の同期や履歴管理は行わない）
- **状態管理**: zustand（グローバル state は zustand を採用）
- **永続化方針**: `localStorage` は使用しない。設定の永続化・移行は初期設定 JSON のインポート/エクスポートで行う。
- **担当者**: フィーチャーの担当は単一（`assignee`）を前提とする。
- **plannedVelocity の単位**: `plannedVelocity` は `pt/day`（1日の目標ストーリーポイント）とする。
- **storyPoints の扱い**: `storyPoints` は小数を許容する。
- **データ取得**: 外部 API は使用しない。TSV はクライアントでパースして内部 state に取り込む
- **テスト**: 行わない
- **UI**: 自前実装（既製 UI ライブラリは基本的に使用しない）
- **i18n**: しない
- **認証**: なし

---

## 2. 想定ユーザー

- プロジェクトマネージャ、スクラムマスター、開発メンバー

---

## 3. 機能要件（抜粋）

以下は各画面仕様（フィーチャー / 進捗管理 / チームベロシティ / 設定）を参照して抜粋した機能要件である。実装時は各画面の詳細仕様を必ず参照すること。

- FR-001: TSV インポート（共通）
  - 概要: ユーザーがアップロードした TSV ファイルをクライアントでパースし、行単位で検証して内部の Feature 一覧へ取り込む。
  - 入力: TSV ファイル（ヘッダー行含む）
  - 出力/表示: インポート成功件数／失敗件数サマリ、エラーサンプル、正常行は各画面に反映
  - バリデーション: 必須ヘッダーの存在確認、数値変換可能性（storyPoints 等）、状態が `statusMappings` にマップ可能であること
  - エラー時挙動: 不正行は行単位でスキップ。全行不正なら取り込み中止しユーザーに通知。

- FR-002: フィーチャー一覧表示（フィーチャー画面）
  - 概要: インポート済みの Feature をテーブル表示する（表示専用）
  - 入力: 正規化済み Feature データ
  - 出力/表示: 各行に分類／課題名／storyPoints／見積／実績／イテレーション／状態／担当者を表示
  - 制約: 編集・ソート・フィルタは非対応。表示順はインポート順を維持する。

- FR-003: 進捗集計表示（進捗管理画面）
  - 概要: インポート済みデータを基に、全体および分類（FE/BE/テスト）別の指標を算出して表示する（閲覧専用）。
  - 入力: Feature データ、`projectSettings`（members, iterations, statusMappings, includePRinDone 等）
  - 出力/表示: 全ストーリーポイント、完了ポイント、予定進捗率、実施進捗率、誤差ポイント 等（画面の列として表示）
  - バリデーション/前提: storyPoints null/undefined は集計除外。完了判定は `statusMappings` と `includePRinDone` に依存。
  - エラー時挙動: 集計除外行はエラーパネルに一覧表示。
  - 非機能: インポート／データ更新で自動再集計、画面リロード不要（目標: 表示反映 1 秒以内は受入条件の一例）。

- FR-004: チームベロシティ表示（チームベロシティ画面）
  - 概要: 指定イテレーションの目標PT／実績PTをイテレーション／ロール／個人単位で算出・表示する。
  - 入力: Feature データ、`members`（plannedVelocity 等）、`iterations`（稼働日）
  - 出力/表示: イテレーション名・開始日・稼働日数・目標合計PT・実績合計PT・分類別（FE/BE/テスト）目標/実績・各人の目標消化PT 等
  - バリデーション/前提: 完了判定関数 `isDone(feature)` を用いる。
- FR-005: 設定管理（設定画面 / 初期設定ダイアログ）
  - 概要: ヘッダーマッピング、イテレーション、メンバー、`includePRinDone` 等の設定をインポート/編集/エクスポートする。
  - 入力: 初期設定 JSON のインポート、画面上での編集操作
  - 出力/表示: 現在設定の確認、JSON エクスポートボタン、編集用のドラフト保存・バリデーション・正式保存
  - バリデーション: JSON スキーマ検証（必須フィールドの存在、日付フォーマット、稼働日が整数等）、編集時は項目単位バリデーションを実施
  - 永続化: `localStorage` は使用せず、永続化・移行は初期設定 JSON のインポート/エクスポートで行う。起動時はインポート済み JSON を基に設定を初期化する。

- FR-006: ヘッダーマッピング自動適用
  - 概要: 初期設定 JSON に `headerMapping` が含まれる場合、ヘッダーマッピング画面で自動適用してユーザーが編集可能にする。
  - 入力: インポート済み `headerMapping`、TSV ヘッダー
  - 出力/表示: 自動マッピング済みの割当表示、必須項目が未マップの場合は次へ進めないガード

- FR-007: 入力／編集ワークフローと保存ポリシー
  - 概要: 設定画面は「閲覧モード」と「編集モード」を持ち、編集はドラフトで行い `保存` ボタンで反映する。TSV インポートは即時反映するが設定の永続化は JSON エクスポートによって行う。
  - バリデーション: 保存時に全体バリデーションを行い、失敗時はエラー表示と保存中止。キャンセルでドラフトを破棄。

- FR-008: アクセシビリティと操作性
  - 概要: キーボード操作（Tab/Enter/Esc）とスクリーンリーダー用のラベル/aria 属性を考慮して実装する。

---

## 4. 非機能要件（抜粋）

- パフォーマンス：TSV 1,000行程度はクライアント即時表示
- アクセシビリティ：キーボード操作、aria 属性を考慮

---

## 5. 画面一覧・導線

概要：本アプリはシングルページアプリ（SPA）構成とし、メイン画面はタブで切り替えるUIとする。ルーティングは行わない。各タブは内部 state による遷移で、URL の同期やハッシュ運用は行わない。初回起動時は必須設定を促す `初期設定ダイアログ` を表示する。

- 画面一覧（タブ／ダイアログ）:

- 初期設定ダイアログ：初回起動で表示するモーダル。イテレーション期間、メンバー一覧、status マッピング、TSV ヘッダーマッピング等の「初回必須設定」を行う。アプリ起動直後のみ表示される別物として扱う（保存後は閉じる）。
- 設定画面：常設の設定タブまたはメニュー項目。初期設定ダイアログと役割を分け、メンバー編集、イテレーション編集、設定のインポート/エクスポート、デフォルト値の変更等を行うための画面。
- チームベロシティー画面：イテレーション別の目標/実績PT、個人別消化状況、稼働日数などを可視化するタブ。
- 進捗管理画面：ステータス別カンバン/集計テーブルでの進捗管理、担当・ステータス・イテレーションでのフィルタを提供するタブ。
- フィーチャー一覧画面：TSV インポート、フィルタ、テーブル表示、行単位編集やエクスポートを行うタブ。

導線：

- アプリ上部または左縦にタブバーを配置し、ワンクリックでタブ切替。タブ間でデータは共有（zustand を想定）。
- 初期設定ダイアログはアプリ起動時に必須フローとして表示。起動後は閉じ、以降の設定変更は `設定画面` から行う。設定未完了ユーザーは他タブへ遷移できるが、編集や保存時にバリデーションでエラーとなる可能性を明示する。

---

## 6. ワイヤー（簡易）

- 初期設定ダイアログ
  - モーダル形式で表示。イテレーション期間、メンバー一覧（追加/削除）、status マッピング、TSV ヘッダーマッピングの入力を行う。保存／キャンセル。必須項目はバリデーションで制御。

- チームベロシティー画面
  - イテレーション選択セレクタ、各イテレーションのカード表示（目標PT／実績PT／開始日／稼働日数）、個人別消化行表示、`includePRinDone` トグル。

- 進捗管理画面
  - ステータス列によるカンバン表示または集計テーブル切替。

- フィーチャー一覧画面
  - テーブル表示

- 設定画面
  - 設定の一覧表示と編集（メンバー/イテレーション/status マッピング/TSV ヘッダマップ）、JSON インポート/エクスポート、デフォルト値の変更。

---
